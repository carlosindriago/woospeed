# PHPStan Configuration for WooSpeed Analytics
# Senior-level static analysis setup

parameters:
    # Analysis level - 9 is the maximum strictness
    level: 9

    # Paths to analyse
    paths:
        - woospeed-analytics.php
        - includes/
        - admin/

    # Paths to exclude from analysis
    excludePaths:
        - tests/
        - vendor/
        - languages/
        - assets/

    # Ignore errors for specific WordPress/WooCommerce patterns
    ignoreErrors:
        # Allow mixed return types from WordPress functions
        - '#Mixed return type#'

        # Allow dynamic property access in WordPress
        - '#Access to an undefined property#'

        # WordPress hooks with unknown parameters
        - '#Parameter .* of function .* has invalid typehint type mixed#'

        # Allow accessing array offsets on mixed (common in WordPress options/transients)
        - '#Cannot access offset .* on mixed#'

        # Allow mixed parameters in WordPress functions
        - '#Parameter .* of function .* expects .*, mixed given#'

        # Allow mixed in echo/printf
        - '#Parameter .* of echo cannot be converted to string#'
        - '#Parameter .* of function printf expects .*, mixed given#'

        # Allow missing array value types (common in WordPress)
        - '#no value type specified in iterable type array#'

        # Allow int|WC_Order union types from wc_get_order
        - '#Cannot call method .* on int\|WC_Order#'
        - '#expects WC_Order, int\|WC_Order given#'
        - '#expects int, int\|WC_Product given#'
        - '#expects int, int\|WC_Order given#'

        # Allow calling methods on WC_Order|false
        - '#Cannot call method .* on WC_Order\|false#'

        # Allow DateTime edge cases
        - '#Call to an undefined method DateTime::date#'
        - '#int\|false given#'

        # Allow unreachable code (sometimes intentional in WordPress)
        - '#Unreachable statement#'

    # Check for missing typehints
    checkMissingIterableValueType: false
    checkGenericClassInNonGenericObjectType: false

    # Universal Object Crates for WordPress
    universalObjectCratesClasses:
        - WP_Post
        - WC_Order
        - WC_Product

    # Bootstrap files for WordPress/WooCommerce functions
    bootstrapFiles:
        - %currentWorkingDirectory%/phpstan-bootstrap.php

    # Stubs for WordPress functions
    scanFiles:
        - %currentWorkingDirectory%/phpstan-stubs.php

    # Parallel processing (faster analysis)
    parallel:
        jobSize: 20
        maximumNumberOfProcesses: 32
        minimumNumberOfJobsPerProcess: 2

    # Result cache
    tmpDir: build/phpstan

    # Report unmatched ignored errors
    reportUnmatchedIgnoredErrors: false
